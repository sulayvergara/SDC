<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Gestión de Preguntas</title>
    <style>
        body { 
            font-family: Arial; 
            max-width: 800px; 
            margin: 20px auto; 
            padding: 20px; 
        }
        .form-group { margin: 10px 0; }
        .question-item { 
            border: 1px solid #ddd; 
            padding: 10px; 
            margin: 10px 0; 
        }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>Gestión de Preguntas</h1>

    <div id="formulario">
        <h2>Nueva Pregunta</h2>
        <div class="form-group">
            <label>Pregunta:</label>
            <input type="text" id="questionText">
        </div>

        <div class="form-group">
            <label>Opción 1:</label>
            <input type="text" id="option1">
            <input type="checkbox" id="correct1">
            <label>Correcta</label>
        </div>

        <div class="form-group">
            <label>Opción 2:</label>
            <input type="text" id="option2">
            <input type="checkbox" id="correct2">
            <label>Correcta</label>
        </div>

        <div class="form-group">
            <label>Opción 3:</label>
            <input type="text" id="option3">
            <input type="checkbox" id="correct3">
            <label>Correcta</label>
        </div>

        <button onclick="crearPregunta()">Crear Pregunta</button>
        <div id="error" class="error"></div>
    </div>

    <div id="listado">
        <h2>Preguntas Existentes</h2>
        <div id="questionList"></div>
    </div>

    <script>
        // Cargar preguntas al iniciar
        cargarPreguntas();

        function cargarPreguntas() {
            fetch('/preguntas')
                .then(response => response.json())
                .then(preguntas => {
                    const lista = document.getElementById('questionList');
                    lista.innerHTML = '';
                    
                    preguntas.forEach(pregunta => {
                        const div = document.createElement('div');
                        div.className = 'question-item';
                        div.innerHTML = `
                            <p><strong>${pregunta.question}</strong></p>
                            <ul>
                                ${pregunta.options.map(opt => 
                                    `<li>${opt.option}. ${opt.text} ${opt.option === pregunta.answer ? '✓' : ''}</li>`
                                ).join('')}
                            </ul>
                            <button onclick="eliminarPregunta('${pregunta._id}')">Eliminar</button>
                        `;
                        lista.appendChild(div);
                    });
                })
                .catch(error => mostrarError('Error al cargar preguntas'));
        };

        function crearPregunta() {
            // Obtener los valores del formulario
            const preguntaTexto = document.getElementById('questionText').value;
            const opcion1 = document.getElementById('option1').value;
            const opcion2 = document.getElementById('option2').value;
            const opcion3 = document.getElementById('option3').value;

            // Determinar cuál es la respuesta correcta basada en el radio button seleccionado
            let respuestaCorrecta = '';
            if(document.getElementById('correct1').checked) respuestaCorrecta = 'A';
            if(document.getElementById('correct2').checked) respuestaCorrecta = 'B';
            if(document.getElementById('correct3').checked) respuestaCorrecta = 'C';

            // Crear el objeto con el formato correcto
            const pregunta = {
                question: preguntaTexto,
                options: [
                    {
                        option: "A",
                        text: opcion1
                    },
                    {
                        option: "B",
                        text: opcion2
                    },
                    {
                        option: "C",
                        text: opcion3
                    }
                ],
                answer: respuestaCorrecta
            };

            // Validar que todos los campos estén llenos
            if(!preguntaTexto || !opcion1 || !opcion2 || !opcion3 || !respuestaCorrecta) {
                mostrarError('Por favor completa todos los campos y selecciona una respuesta correcta');
                return;
            }

            // Enviar al servidor
            fetch('/preguntas', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(pregunta)
            })
            .then(response => response.json())
            .then(data => {
                limpiarFormulario();
                cargarPreguntas();
                mostrarError('Pregunta creada con éxito');
            })
            .catch(error => mostrarError('Error al crear la pregunta'));
        }

        // Función auxiliar para limpiar el formulario
        function limpiarFormulario() {
            document.getElementById('questionText').value = '';
            document.getElementById('option1').value = '';
            document.getElementById('option2').value = '';
            document.getElementById('option3').value = '';
            document.getElementById('correct1').checked = false;
            document.getElementById('correct2').checked = false;
            document.getElementById('correct3').checked = false;
        }
        function eliminarPregunta(id) {
            if (confirm('¿Eliminar esta pregunta?')) {
                fetch(`/preguntas/${id}`, {
                    method: 'DELETE'
                })
                .then(response => {
                    cargarPreguntas();
                    mostrarError('Pregunta eliminada');
                })
                .catch(error => mostrarError('Error al eliminar'));
            }
        }

        function limpiarFormulario() {
            document.getElementById('questionText').value = '';
            document.getElementById('option1').value = '';
            document.getElementById('option2').value = '';
            document.getElementById('option3').value = '';
            document.getElementById('correct1').checked = false;
            document.getElementById('correct2').checked = false;
            document.getElementById('correct3').checked = false;
        }

        function mostrarError(mensaje) {
            document.getElementById('error').textContent = mensaje;
            setTimeout(() => {
                document.getElementById('error').textContent = '';
            }, 3000);
        }
    </script>
</body>
</html>